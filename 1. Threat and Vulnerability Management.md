# Threat and Vulnerability Management
---
## 1.1 Explain the importance of threat data and intelligence


Intelligence Sources
- Open Source: ATT Security, Malware Information Sharing Project (MISP), Spamhaus
- Closed Source: IBM X-Force, Recorded Future, FireEye
	- In closed source, the provider does their own research and analysis efforts such as information from customer systems or honeynets.

Confidence Levels - How to rate your intelligence sources
- Relevant: Does the information directly relate to the threats of the organization?
- Accurate: Is the information valid and true? Is the information general or specific?
- Timely: Can the information be generated and distributed quickly?

Narrative Reports - big picture intelligence reporting
Data Feeds - specific threats

Indicator Management
Standardize threat indicators in order to facilitate sharing.
- CybOX
	- Describes observable security events
	- The schema that STIX uses
- STIX
	- JSON to standardize threat intelligence
	- 12 domains, current version is STIX 2.0
	- STIX 1.x uses XML, STIX 2.x uses JSON
- TAXII
	- Allows threat information to be communicated via HTTPS
	- Used with STIX
- OpenIOC
	- XML framework created by Mandiant (security team from Fireeye)


12 STIX Domains
1. Attack Pattern - describe ways that adversaries attempt to compromise targets
2. Campaign - A grouping of adversarial behaviors that describes a set of malicious activities or attacks (sometimes called waves) that occur over a period of time against a specific set of targets.
3. Course of Action - A recommendation from a producer of intelligence to a consumer on the actions that they might take in response to that intelligence.
4. Grouping - Explicitly asserts that the referenced STIX Objects have a shared context
5. Identity - Actual individuals, organizations, or groups (e.g., ACME, Inc.) as well as classes of individuals, organizations, systems or groups (e.g., the finance sector).
6. Indicator - Contains a pattern that can be used to detect suspicious or malicious cyber activity.
7. Infrastructure - describes any systems, software services and any associated physical or virtual resources intended to support some purpose
8. Intrusion Set - A grouped set of adversarial behaviors and resources with common properties that is believed to be orchestrated by a single organization.
9. Location - Represents a geographic location.
10. Malware - malicious code
11. Malware Analysis - metadata and results of a particular static or dynamic analysis performed on a malware instance or family
12. Note - Conveys informative text to provide further context and/or to provide additional analysis not contained in the STIX Objects
13. Marking Definition objects, or Language Content objects which the Note relates to.
14. Observed Data - information about cyber security related entities such as files, systems, and networks using the STIX Cyber-observable Objects (SCOs).
15. Opinion - An assessment of the correctness of the information in a STIX Object produced by a different entity.
16. Threat Actor - Actual individuals, groups, or organizations believed to be operating with malicious intent.
17. Tool - Legitimate software that can be used by threat actors to perform attacks.
18. Vulnerability - A mistake in software that can be directly used by a hacker to gain access to a system or network.

2 STIX Relationship Objects (SROs)
1. Relationship - Used to link together two SDOs or SCOs in order to describe how they are related to each other.
2. Sighting - Denotes the belief that something in CTI (e.g., an indicator, malware, tool, threat actor, etc.) was seen.

Threat Classification
- Known threats: you have information and are aware
- Unknown threats: no information and unaware
- Use controls and processes to deal with unknown threats
	- Examples of control types:
	- Detective administrative: job rotation
	- Detective physical: CCTV
	- Recovery logical: centralized data backups
	- Preventive administrative: security awareness training
	- Preventive logical: biometric
	- Preventive physical: mantraps
- Advanced persistent threat (APT): nation sponsored hackers
- Zero-day threat: threats that exploit an unknown security vulnerability

Threat Actors
- Nation-state: APT organizations funded by national government
- Hacktivist: black hats seeking political gain
- Organized crime: black hats seeking financial gain through methods such as ransomware attacks
- Insider threat: employees or trusted individuals within a company

Intelligence Cycle
- Requirements: determine needed information
- Collection: gather information to meet requirements
- Analysis: Process the data into a common format, then analyze it
- Dissemination: Share analyzed intelligence, provide reports to leadership
- Feedback: Gather feedback about the reports and identify improvements

Commodity Malware
- Malware that is written and then sold on the open(black) market.
- Can be part of a toolkit or sold as stand-alone tools.

ISAC - Information Sharing and Analysis Communities
- Help infrastructure owners and operators share threat information, as well as provide tools and assistance.
- https://www.nationalisacs.org/member-isacs-3
- Healthcare ISAC (H-ISAC): h-isac.org
- Financial ISAC: fsisac.com
- Aviation ISAC: a-isac.com

Threat Analysis
1. Develop a list of threats
2. Assess threats based upon likelihood
3. Assess threats based upon impact
4. Create a threat register

## 1.2 Utilize threat intelligence to support organizational security
Attack Frameworks
- MITRE ATT&CK
	- Database for tactics, techniques, and procedures (TTPs)
	- Separates TTPs into distinct resources with unique IDs and a variety of categories
	- https://attack.mitre.org/#
- Diamond Model
	- Adversary: the actor/organization responsible for utilizing the opportunity to fulfill their objective against the victim
	- Capability: tools or techniques used in the event
	- Victim: the target
	- Infrastructure: physical or logical systems for delivering capability, retaining control, and determining the victim's impact outcomes.
- Lockheed Martin Cyber Kill Chain
	- Recon: target selection, research, vulnerability id
	- Weaponize: create tools to exploit vulnerabilities
	- Delivery: deliver the weapon (email, thumbdrive, website, etc)
	- Exploit: malware is triggered and exploits vulnerabilities
	- Install: remote access tools and backdoors installed
	- Command and Control: persistent access
	- Actions on Objective: intruder takes action: 
		- data acquisition and extraction
		- data damage
		- system damage

Threat Research
- Reputational: looking at information (such as an IP address or domain name) to determine if there is a history of malicious behavior.
- Behavioral: examining the context of actions

Indicators of Compromise (IoC): forensic evidence or data that can help to identify an attack.
Examples of IOC:
- Unusual binary files
- Unexpected process or resource consumption
- Deviations in network traffic
- Unexplained log entries
- Unapproved configuration changes

Threat Management Focused Approaches:
- Asset Focus - asset inventory is the basis for analysis
- Threat Focus - identify how specific threats may affect each information system
- Service Focus - indentify the impact of various threats on a specific service

Categorizing attacks:
STRIDE model
- Spoofing
- Tampering
- Repudiation
- Information Disclosure
- Denial of Service
- Elevation of Privilege

Threat Modeling Methodologies
- Adversary capability
	- Acquired and augmented: common malware techniques or modified techniques
	- Developed: identify and exploit zero-day, but uses human and financial resources
	- Advanced: supply chains that have been exploited
	- Integrated: hardware exploits or non-cyber tools such as political or military resources
- Total attack surface: all attack vectors
	- Corporate network: ftp, vpn, wifi, access employees use
	- Website and cloud: front-end servers, APIs
	- Internal custom apps: forms, http, open ports
	- Cyber: social media, usb storage
	- Physical: gates, cameras, facilities
	- Human: social engineering
- Attack Vector: the points an attacker could enter the system
- Impact: low, medium, high, depending on a variety of factors
- Likelihood: the percentage that a vulnerability will be exploited

Threat Intelligence Sharing with Supported Functions
- Incident response
	- Responding to computer security incidents by following standardized response procedures.
	- A security incident is a violation of computer security policy, acceptable use policy, or standard security practices.
- Vulnerability management
	- Seek to identify, prioritize, and remediate vulnerabilities before an attacker exploits them to undermine the confidentiality, integrity, or availability of enterprise information assets.
- Risk management
	- Identify risks
	- Determine the severity of each risk
	- Adopt one or more risk strategies to to address each risk
- Security engineering
	- The proces of incorporating security controls into an information system so that the controls become an integral part of the system's operational capabilities.
- Detection and monitoring: process security information, often using a SIEM
	- Privileged account usage
	- Privilege changes and grants
	- Account creation and modification
	- Employee termination and terminated account usage
	- Account life cycle management events
	- Separation-of-duty violations


## 1.3 Perform vulnerability management activities
Vulnerability Identification
- Asset criticality
- Active scanning: interacts with network systems directly to probe them for accessibility
- Passive scanning: gather information about networked systems without direct interaction.
- Mapping/Enumeration

Validation
True positive: reported and exists
False positive: reported and doesn't exist
False negative: not reported, exists
True negative: not reported, doesn't exist
Positive/Negative = reported/not reported
True/False = exists/not exist

Remediation Priority
- Vulnerability severity
- System criticality
- Information sensitivity
- Remediation difficulty
- System exposure

Remediation/Mitigation
- Configuration baseline
- Patching
- Hardening
- Compensating controls
- Risk acceptance
- Verification of mitigation

Remediation Workflow
1. Detection
2. Analysis
3. Remediation
4. Remediation Validation

Scanning parameters and criteria
- Scanning risks
- Vulnerability feed
- Scope
- Credentialed vs non-credentialed
- Server vs agent-based
- Internal vs external
- Special considerations

Inhibitors to remediation
- MOU
- SLA
- Organizational Governance
- Business process interruption
- Proprietary systems
- Legacy systems
- Degraded functionality

Dealing with inhibitors:
- Demonstrate that the vulnerability can be discovered with off the shelf tools
- Plan ahead to manage emergency changes
- Explain the consequences of the vulnerability, through business impact

Steps of implementing an information security vulnerability management process:
1. Identify requirements
	1. Corporate Policy
	2. Asset inventory
	3. Regulatory environment
2. Establish scanning frequency
	1. Constraints to scanning frequency:
	2. Regulatory and corporate requirements
	3. Organization's risk appetite
	4. Technical constraints (number of scanners, bandwidth, etc)
	5. Business constraints
	6. Licensing constraints
3. Configure the tools to perform the vulnerability scan.
4. Execute the vulnerability scan.
5. Generate reports.
6. Implement remediation.
7. Ongoing scanning and continuous monitoring.

A risk assessment matrix is created where subject experts grade all risk on their likelihood and their impact. This helps to prioritize the application of resources  to the most critical vulnerabilities.

Vulnerability scanning guidance:
- PCI DSS requires no results higher than 4.0 CVSS
- Check configuration management systems, log repositories, and other data sources
- Compare scan results with itself using trend analysis

## 1.4 Analyze the output from common vulnerability assessment tools
Web Application Scanner
- Zed Attack Proxy (ZAP)
- BURP
- Nikto
- Arachni

Infrastructure Vulnerability Scanner
- Nessus
- OpenVAS
- Qualys

Software Assessment Tools and Techniques
- Static analysis
- Dynamic analysis
- Reverse engineering
- Fuzzing

Enumeration (Active tools)
- Nmap
	- syn scan
	- tcp scan
	- -o to discover OS
- Hping
	- ping utility that allows you to specify different options (such as alternate port) in order to bypass firewalls.
- Responder
	- Python script that places the attacker between the target to intercept requests.
	- LLMNR/NBT-NS (netbios name service)/mDNS Poisoner

Wireless Assessment Tools
- Aircrack-ng: suite of utilities for wifi testing
  - airmon-ng: used to enable and disable monitor mode (promiscuous mode)
  - airodump-ng: captures 802.11 frames and uses this output to identify the MAC address of the access point
  - aireplay-ng: inject frames to obtain the authentication credentials for an access point
  - aircrack-ng: breaks WiFi passwords
- Reaver: exploit wps to retrieve wpa and wpa2 passwords
- Hashcat: password cracking/recovery tool

Cloud Infrastructure Assessment Tools
- ScoutSuite
	- Audit instances and policies created on multi-cloud platforms (AWS, GCP, Azure)
	- Uses API calls to compile an HTML report
	- Built in Python
- Prowler
	- Evaluate cloud infrastructure against AWS Benchmarks
	- Audit only tool, for AWS
- Pacu
	- exploitation framework to test AWS security configurations (such as gaining control of a vm)


## 1.5 Explain the threats and vulnerabilities associated with specialized technology

ICS - Industrial control systems
- Monitor and control industrial processes
- Includes building automation, workflow automation, and process automation systems
- Less likely to be currently patched

ICS Types
- SCADA
	- Remote monitoring
	- Remote telemetry
	- Reports back to control systems
- DCS - Distributed control systems
	- Focus on controlling processes
	- Use sensors and feedback systems
- PLC - Programmable logic controllers
	- Handle specialized I/O
	- Ensure uninterrupted processing
	- Connect to human machine interface
	- Use a special protocol called Modbus for serial interface communications

IoT - Internet of Things
- Smart devices are computer controlled and network connected
- Embedded systems refer to smart devices
- It is difficult to update the software and underlying OS
- Connect to home and office wireless networks
- Often connect back to cloud services for command and control

Embedded Systems
- SoC - System on a chip; combines cpu, memory, networking, and other components onto a single chip.
- FPGAs - chips that allow dynamic reprogramming
- eFuse - IBM technology that allows dynamic modification on the chip
- RTOS - real-time operating systems provide reliable and secure computing for IoT devices.
- CAN Bus - facilitates embedded device communications

## 1.6 Explain the threats and vulnerabilties associated with operating in the cloud
Infrastructure as a Service (IaaS) provisions IT resources such as servers and storage components. The client company ensures the confidentiality, integrity, and availability (CIA) of all virtual machines (or instances) and their operating system.

In an IaaS, the customer is also responsible for managing security of the applications within the instances created. This also applies in a Platform as a Service (PaaS) deployment models.

In an IaaS, the cloud service provider (CSP) is responsible for the physical hosts such as patching hypervisors and preventing insider attacks.

Cloud platforms are accessible via a web interface or web management portal. If an attacker exploits an unsecure form to perform a SQL injection, the CSP is at fault.

## 1.7 Implement controls to mitigate attacks and software vulnerabilities

Common Vulnerabilities:
- Server
	- Missing patches
	- Unsupported OS
	- Buffer Overflow (heap overflow, integer overflow, etc)
	- Privilege escalation
	- Insecure protocol
	- Debugging modes
- Endpoint
	- Missing patches
	- Outdated signatures for security tools
	- Mobile devices
	- Unapproved software
- Network
	- Encryption issues (SSL/TLS)
	- Outdated protocols
	- Insecure cipher suites (encryption algorithms)
	- Certificate issues (expired, self-signed, invalid)
	- DNS vulnerabilities
	- Interconnected networks
- Virtualization
	- Hypervisor patching
	- VM escape
	- Virtual network security controls
	- Access to virtualization management interfaces

Web Security Vulnerabilities:
OWASP Top 10 - The Open Web Application Security Project (owasp) maintains a list of common web security issues.
1. Injection flaws: insert unwanted transaction code
2. Broken authentication: flaws in authentication mechanisms
3. Sensitive data exposure: sensitive information is accidentally exposed
4. XML external entitities
5. Broken Access Control
6. Security misconfigurations
7. Cross-Site scripting (XSS): inserting malicious scripts on websites
8. Insecure deserialization: api exploitation
9. Using vulnerable components
10. Insufficient logging

XSS - Cross-site scripting
- Attacker tricks a user's browser to download a script from one site, and execute it on another site.

Requires:
- Reflected input: input provided by the user is later displayed to other users.
- Unvalidated input: input is not scrubbed for security issues.

Types of XSS:
- Stored (Persistent) XSS
	- The attack is stored on a remote server, waiting for a victim to discover it.
- Reflected XSS
	- The attack is unintentionally sent to the server by the victim and then returned in the resulting webpage.
- DOM XSS
	- The attack takes place entirely within the user's browser with code stored in the document object model (DOM)

Privilege Escalation
- Elevating access from standard user to administrator
- Mitigate with input validation from users
- OS, platforms, and applications should be patched.
- Enforce the least privilege principle
- Use DEP and ASLR technologies
	- Data execution prevention
	- Address space layout randomization

Directory traversal
- View unintended directories by relative paths (such as ../.. to navigate up directories)

Race condition
- Occurs when the proper functioning of a security control depends upon the timing of actions performed by the user or computer.
- Prevent simultaneous transactions from causing race conditions by using locks. For example, prevent two users from accessing the same account at the same time.

Dereferencing null pointers
- A null pointer is a pointer referencing an unknown memory address
- Trying to retrieve contents at an unknown location creates an unpredictable state

Interception Proxies:
- ZAP
- Burp Suite
- Vega